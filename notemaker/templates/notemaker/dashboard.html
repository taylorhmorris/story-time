{% load static %}

<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="{% static 'notemaker/css/ankicard.css' %}">
</head>
<body>

<button id="startReview">Start Review</button>
<button id="hardResetButton">Hard Reset</button>

<div id="resultModal" class="modal">
    <div id="modal" class="modal-content">
        <span class="close">&times;</span>
        <div id="resultWindow" class="modal-content">
            <span class="flashcard">
                <div id="front"></div>
                <div id="back"></div>
                <div id="rate_bar_show">
                    <button class="flipCard">Show Answer</button>
                </div>

                <div id="rate_bar_rate" style="display: none;">
                    <button id="rate_0" class="rate_button">Incorrect</button>
                    <button id="rate_1" class="rate_button">Correct</button>
                    <button id="rate_2" class="rate_button">Easy</button>
                    <button class="flipCard">Flip Card</button>
                </div>
            </span>
        </div>
    </div>
</div>

<div id="holdingBay" style="display: block;">
</div>


<script src="{% static 'notemaker/js/jquery-3.1.0.min.js' %}"></script>
<script type="text/javascript" src="{% static 'notemaker/js/tts.js' %}"></script>
<script type="text/javascript" src="{% static 'notemaker/js/displayCard.js' %}"></script>

<script type="text/javascript">
function drawCard(card){
    let h = card.getHTML();
    $("#resultWindow").html( h );
    $("#resultModal").show();
}

function openModal(card){
    $("#resultModal").show();
}

function queueCards(cards){
    for (card of cards){
        let flashcard = new FlashCard(card);
        let h = flashcard.getHTML();
        $("#holdingBay").append(h);        
    }
    $( "#resultModal" ).trigger( "finish-card", [-1] );
    openModal();
}

$( document ).ready(function() {
    $("#resultModal").hide();
});

function startReview(){
    console.log("Starting review ;)");
    $.ajax({
        url: "{% url 'ajax-review-cards' %}",
        data: {'max_number': 10},
        dataType: 'json',
        success: function (data) {
            if (data['success'] === true){
                console.log( data['cards'] );
                queueCards(data['cards']);
            }
            else{
                $( "#resultWindow span" ).html(data['message']);
                openModal();
            }
        }
    });   
}

$("#startReview").click(function(){
    startReview();
});

$("#hardResetButton").click(function(){
    $.ajax({
        url: "{% url 'api' %}",
        data: {'request': 'reset',
                'flags': ['hard',]},
        dataType: 'json',
        success: function (data) {
            console.log( data );
        }
    });   
});

$( document ).on('click', '.close', function(){
    $( "#resultModal" ).trigger('click')
});

$( document ).on('click', '#resultModal', function(event){
    event.stopPropagation();
    if (event.target.id == 'resultModal'){
        $(".modal").hide();
        $("#holdingBay").empty();
    };
});

$( document ).on('finish-card', '#resultModal', function(event, message){
    console.log(event);
    console.log(message);
    if ( $("#holdingBay span").first().length ){
        $("#resultWindow").find(".flashcard").replaceWith( $("#holdingBay span").first() );
    } else {
        $( "#resultModal" ).trigger('click')
    }
});



</script>

</body>
</html>


